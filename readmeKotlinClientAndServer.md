# Checkme
Сервис автоматической проверки заданий студентов.
Позволяет создавать задания и проверки к ним.

## Сервер
Сервер работает с базами данных PostgreSQ(основная база) и MariaDB(база проверок), перед стартом приложения необходимо создать соответствующие контейнеры в Docker.
### Подготовка СУБД
1. Запустите сервер PostgreSQL. Рекомендуемый вариант — [контейнер](https://github.com/docker-library/docs/blob/master/postgres/README.md) в docker.
    ```bash
   docker run -d --name checkmedb -e POSTGRES_PASSWORD=mysecretpassword -p 5432:5432 postgres:16.3
    ```
2. Создайте на сервере базу данных `checkme`
   ```bash
   CREATE DATABASE checkme;
    ```
3. Запустите сервер MariaDB.
    ```bash
    docker run -d --name checkmedbcheck -e MARIADB_ROOT_PASSWORD=password -p 3306:3306 mariadb:12.0
    ```

### Настройка параметров запуска
1. Создайте копию файла `app.properties.example` с именем `app.properties`.
2. В случае, если вы меняли какие-то параметры СУБД, соответствующим образом отредактируйте `app.properties`.

Примечание: параметр `logging.overall` в файле `app.properties.example`
- **logging.overall=true** означает, что журнал приложения будет содержать полный список действий пользователя, ошибки работы приложения и подробную отладочную информацию.
- **logging.overall=false** означает, что журнал приложения будет содержать список основных действий пользователя и ошибки работы приложения.


## Клиент
### Инструкция по запуску клиента
1. Настроить переменные окружения \
   Необходимо скопировать файл app.properties.js.example в
   директории webpack.config.d, которая находится в корне проекта.
   Сам файл необходимо настроить, указав значения переменных с теми же именами и типами как в примере.
2. Запустить kotlinClient через gradle run
3. Запустить kotlinServer \
   (Перед запуском проверить адрес клиента в файле
   src\main\kotlin\checkme\web\filters\CorsFilter.kt.
   Он должен соответствовать фактическому адресу клиента. По умолчанию это "http://localhost:8080")


## Создание задач и проверок
### Общие подготовительные данные
При создании задачи в приложении необходимо будет прикрепить json-файл, содержащий информацию о всех проверках задачи:
   ```json
   {
       "Название проверки": {
          "description": "Описание корректного выполнения проверки",
          "score": 10,
          "test": "check.json", 
          "message": "Сообщение в случае невыполненной проверки"
       },
       "Следующая проверка": {
          
       }
   }
   ```
Поле `score` содержит баллы за успешно выполненную проверку.\
Поле `expected` содержит имя файла конкретной проверки.

### Типы проверок и файлы для них
Примеры задач и проверок находятся в [examples](kotlinServer/dev-tools/examples).\
Поля файлов-проверок отличаются в зависимости от типа проверки.

1. Console-check (консольная проверка).\
   Json-файл консольной проверки должен включать в себя следующие поля:
    ```json
    {
      "type": "console-check",
      "command": "printf \"5\\n3\\n\" | python3 ./*.py", 
      "expected": "8.0"
    }
    ```
   Поле `command` содержит команду для выполнения.\
   Поле `expected` ожидаемый результат команды.

2. Sql-check (проверка запросов SQL).\
   Json-файл sql-проверки должен включать в себя следующие поля:
    ```json
    {
      "type": "sql-check",
      "dbScript" : "script.sql",
      "referenceQuery": "эталонный SQL-запрос;"
    }
    ```
   Дополнительно для таких проверок требуется создать начальный скрипт инициализации базы данных — поле `dbScript`, в которой будет выполняться проверка.
   Скрипт можно прикрепить в форме создания задачи.
   


