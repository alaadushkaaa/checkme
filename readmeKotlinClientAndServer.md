# Checkme
Сервис автоматической проверки заданий студентов.
Позволяет создавать задания и проверки к ним.

## Сервер
Сервер работает с базами данных PostgreSQ(основная база) и MariaDB(база проверок), перед стартом приложения необходимо создать соответствующие контейнеры в Docker.
### Подготовка СУБД
1. Запустите сервер PostgreSQL. Рекомендуемый вариант — [контейнер](https://github.com/docker-library/docs/blob/master/postgres/README.md) в docker.
    ```bash
   docker run -d --name checkmedb -e POSTGRES_PASSWORD=mysecretpassword -p 5432:5432 postgres:16.3
    ```
2. Создайте на сервере базу данных `checkme`
   ```bash
   CREATE DATABASE checkme;
    ```
3. Запустите сервер MariaDB.
    ```bash
    docker run -d --name checkmedbcheck -e MARIADB_ROOT_PASSWORD=password -p 3306:3306 mariadb:12.0
    ```

### Настройка параметров запуска
1. Создайте копию файла `app.properties.example` с именем `app.properties`.
2. В случае, если вы меняли какие-то параметры СУБД, соответствующим образом отредактируйте `app.properties`.

## Клиент
### Инструкция по запуску клиента
1. Перед запуском проверить адрес клиента в файле [CorsFilter.kt](kotlinServer/src/main/kotlin/checkme/web/filters/CorsFilter.kt)
   Он должен соответствовать фактическому адресу клиента. По умолчанию это "http://localhost:8080"
2. Запустить kotlinClient через gradle run \
   (В файле [CheckMe.kt](kotlinClient/src/jsMain/kotlin/CheckMe.kt) адрес сервера указан в переменной serverUrl.
   Он должен соответствовать фактическому адресу сервера)


## Создание задач и проверок
### Общие подготовительные данные
При создании задачи в приложении необходимо будет прикрепить json-файл, содержащий информацию о всех проверках задачи:
   ```
   {
       "Название проверки": {
          "description": "Описание корректного выполнения проверки",
          "score": 10, //баллы за успешно выполненную проверку
          "test": "check.json", //файл конкретной проверки 
          "message": "Сообщение в случае невыполненной проверки"
       },
       {
        ...
       }
   }
   ```

### Типы проверок и файлы для них
Примеры задач и проверок находятся в [examples](kotlinServer/dev-tools/examples).\
Поля файлов-проверок отличаются в зависимости от типа проверки.

1. Console-check (консольная проверка).\
   Json-файл консольной проверки должен включать в себя следующие поля:
    ```
    {
      "type": "console-check",
      "command": "printf \"5\\n3\\n\" | python3 ./*.py", //команда
      "expected": "8.0" //ожидаемый результат
    }
    ```

2. Sql-check (проверка запросов SQL).\
   Json-файл sql-проверки должен включать в себя следующие поля:
    ```
    {
      "type": "sql-check",
      "dbScript" : "script.sql", //имя начального скрипта инициализации
      "referenceQuery": "эталонный SQL-запрос;"
    }
    ```
   Дополнительно для таких проверок требуется создать начальный скрипт инициализации базы данных, в которой будет выполняться проверка.
   Скрипт можно прикрепить в форме создания задачи.
   


